---
title: "Global Carbon Estimates"
author: "Kaydee S. Barker"
date: '2023-09-22'
output: 
  pdf_document:
    toc: yes
  html_document:
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
rm(list=ls()) #clear global environment/workspace
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries}

library(tidyverse) #Tidy packages
library(sf) #Spatial package that can read and create shapefiles 
library(terra) #Raster package
library(ggsci) #Color palettes based on scientific journals, data viz libraries, sci fi

```

## Ecosystem Cover Data

Biomes containing arbuscular mycorrhizal (AM) fungi include croplands, temperate grasslands, savannas and shrublands (i.e. tropical grasslands), temperate forests, and tropical forests. 

I used data from the United Nations Food and Agriculture Organization (FAO)'s Global Land Cover - SHARE database ([Latham et al. 2014](https://www.fao.org/uploads/media/glc-share-doc.pdf)) and [Ecoregions2017](https://developers.google.com/earth-engine/datasets/catalog/RESOLVE_ECOREGIONS_2017) to determine total area in square kilometers for each biome. 

I used median AM and ectomycorrhizal (EcM) fungal tree and shrub data from [Steidinger et al. 2019](https://doi.org/10.1038/s41586-019-1411-2) to determine the area of each biome that might contain each mycorrhizal type. For tundras, I considered 49% to be herbaceous and 37% shrub cover, with the remaining barren ([Walker et al. 2005](https://onlinelibrary.wiley.com/doi/10.1111/j.1654-1103.2005.tb02365.x)).
For savannas, I used a grass:tree ratio of 3.56 ([Belovitch et al. 2023](https://doi.org/10.1111/nph.18909)) and converted this to 78% grass cover and 22% tree cover before applying the AM to EcM proportion for trees. 


```{r load cover data, eval=FALSE}

#Download total land cover map from FAO if not downloaded already
if(file.exists('/glc_shv10_DOM.Tif')){
  print('downloaded')
  }else{
  download.file("https://storage.googleapis.com/fao-maps-catalog-data/uuid/ba4526fd-cdbf-4028-a1bd-5a559c4bff38/resources/GlcShare_v10_Dominant.zip", destfile= "FAO_covermap.zip")
unzip("FAO_covermap.zip", exdir = ".")
file.remove("FAO_covermap.zip")}

biomes <- rast("glc_shv10_DOM.Tif")

#Make df of frequency of each value in raster
landcover <- as.data.frame(freq(biomes)) %>%
  rename("area_sq_km" = "count") 

landcover$biome <- c("Null", "Artificial", "Cropland", "Grassland", "Tree Covered", "Shrubland", "Herbaceous Wetland", "Mangrove", "Sparse Veg", "Bare Soil", "Snow & Glaciers", "Water")

#Download total land cover map from EcoRegions2017 if not downloaded already
if(file.exists('/Ecoregions2017.shp')){
  print('downloaded')
  }else{
  download.file("https://storage.googleapis.com/teow2016/Ecoregions2017.zip", 
                destfile= "Ecoregions2017.zip", method= "libcurl", 
                quiet = FALSE, mode = "w", cacheOK = TRUE,
                options(timeout = max(300, getOption("timeout"))))
unzip("Ecoregions2017.zip", exdir = ".")
file.remove("Ecoregions2017.zip")}

ecoregions <- st_read("Ecoregions2017.shp")

#Calculate area of each ecoregion into sq km
#st_crs(ecoregions) #check coordinate system - WGS 84
ecoregions <- st_make_valid(ecoregions) #fix invalid geometries

#Transform to a projected CRS (e.g., UTM) for accurate area calculations
#Replace EPSG:4326 with planar CRS (e.g., EPSG:3395 for World Mercator)
ecoregions_area <- st_transform(ecoregions, crs = 3395) # EPSG:3395 for World Mercator

#Calculate area in square meters and convert to square kilometers
ecoregions_area$area_sq_m <- st_area(ecoregions_area)
ecoregions_area$area_sq_km <- as.numeric(ecoregions_area$area_sq_m) / 1e6

#Convert into data frame
ecoregions_area <- as.data.frame(ecoregions_area)

#write.csv(ecoregions_area, "ecoregions_area.csv") #save as csv to save time on loading
#ecoregions_area <- read.csv("ecoregions_area.csv") #read in data

```

```{r clean ecoregions data}

Steidinger <- read.csv('AM_EM_proportions.csv') #read in data for myc proportions

#Create new column with more specific ecoregion names
ecoregions_area <- ecoregions_area %>%
  dplyr::select(ECO_NAME, BIOME_NAME, area_sq_km) %>% #select only relevant columns
  na.omit() %>%
  filter(!grepl("Desert", ECO_NAME, ignore.case = TRUE)) %>% #filter out deserts
  filter(!grepl("Rock and Ice", ECO_NAME, ignore.case = TRUE)) %>% #filter out rock and ice
  mutate(across('BIOME_NAME', str_replace, 'Mediterranean Forests, Woodlands & Scrub', 'Mediterranean Forests')) %>%
  mutate(biome = #define biomes more closely
           case_when(grepl("Temperate", BIOME_NAME) & #use grepl to find a substring
													 grepl("Grass", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Grasslands", #set value in new column 
													 grepl("Temperate", BIOME_NAME) & 
													 grepl("prairie", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Grasslands", 
													 grepl("Temperate", BIOME_NAME) & 
													 grepl("Espinal", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Grasslands", 
													 grepl("Temperate", BIOME_NAME) & 
													 grepl("Pampas", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Grasslands", 
													 grepl("Temperate Grasslands, Savannas & Shrublands", BIOME_NAME) & 
													 grepl("Steppe", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Grasslands",  
													 grepl("Temperate Grasslands, Savannas & Shrublands", BIOME_NAME) & 
													 grepl("woodland", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Shrublands",  
													 grepl("Temperate", BIOME_NAME) & 
													 grepl("Shrub", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Shrublands", 
													 grepl("Low Monte", ECO_NAME, ignore.case = TRUE)
													     ~ "Temperate Shrublands",
													 grepl("Temperate Grasslands, Savannas & Shrublands", BIOME_NAME) & 
													 grepl("Savanna", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Savannas", 
													 grepl("Flooded", BIOME_NAME) & 
													 grepl("Savanna", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Savannas", 
													 grepl("Temperate", BIOME_NAME) &
													 grepl("Aspen", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Broadleaf & Mixed Forests",
													 grepl("Mediterranean", BIOME_NAME) & 
													 grepl("chaparral", ECO_NAME, ignore.case = TRUE)
															 ~ "Xeric Shrublands", 
													 grepl("Mediterranean", BIOME_NAME) & 
													 grepl("Matorral", ECO_NAME, ignore.case = TRUE)
															 ~ "Xeric Shrublands", 
													 grepl("Mediterranean", BIOME_NAME) & 
													 grepl("thicket", ECO_NAME, ignore.case = TRUE)
															 ~ "Xeric Shrublands", 
													 grepl("Mediterranean", BIOME_NAME) & 
													 grepl("mixed", ECO_NAME, ignore.case = TRUE)
															 ~ "Temperate Broadleaf & Mixed Forests", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Grass", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Grasslands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Chaco", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Grasslands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("lowveld", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Grasslands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Savanna", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Savannas",  
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Cerrado", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Savannas", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Llanos", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Savannas", 
													 grepl("Tropical & Subtropical Grasslands", BIOME_NAME) &
													 grepl("woodland", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Savannas",
													 grepl("Tropical & Subtropical Grasslands", BIOME_NAME) &
													 grepl("thicket", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Savannas",
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("Shrub", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Shrublands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("scrub", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Shrublands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("bush", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Shrublands", 
													 grepl("Tropical", BIOME_NAME) & 
													 grepl("pine", ECO_NAME, ignore.case = TRUE)
															 ~ "Tropical & Subtropical Coniferous Forests", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("puna", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Grasslands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("p√°ramo", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Grasslands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("Grassland", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Grasslands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("steppe", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Grasslands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("meadow", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Grasslands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("moorland", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Shrublands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("thicket", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Shrublands", 
													 grepl("Montane", BIOME_NAME) & 
													 grepl("woodland", ECO_NAME, ignore.case = TRUE)
															 ~ "Montane Shrublands", 
													 grepl("High Monte", ECO_NAME, ignore.case = TRUE)
													     ~ "Montane Shrublands",
													 grepl("mangrove", ECO_NAME, ignore.case = TRUE)
															 ~ "Mangroves", 
													 grepl("Deserts & Xeric Shrublands", BIOME_NAME)
													     ~ "Xeric Shrublands",
													 grepl("Flooded Grasslands & Savannas", BIOME_NAME)
													     ~ "Flooded Grasslands",
		                           .default = BIOME_NAME)) #set default value


#Create column with area adjusted to AM proportions
ecoregions_area <- ecoregions_area %>%
  bind_rows(landcover[3,]) %>% #bind rows of landcover to ecoregions
  mutate(AM_area = #multiply by proportion of AM
           case_when(biome == "Tundra"
                     ~ ((area_sq_km*0.49)+(area_sq_km*0.37*((Steidinger$median[
                       Steidinger$group_id == "Tundra_AM"])/100))),
                     biome == "Temperate Broadleaf & Mixed Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Temp_mixed_AM"])/100)),
                     biome == "Temperate Conifer Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Temp_conifer_AM"])/100)),
                     biome == "Temperate Savannas"
                     ~ ((area_sq_km*0.78)+(area_sq_km*0.22*((Steidinger$median[
                       Steidinger$group_id == "Temp_savannah_AM"])/100))),
                     biome == "Tropical & Subtropical Moist Broadleaf Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Wet_trop_broadleaf_AM"])/100)),
                     biome == "Tropical & Subtropical Dry Broadleaf Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Dry_trop_broadleaf_AM"])/100)),
                     biome == "Tropical & Subtropical Coniferous Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Trop_conifer_AM"])/100)),
                     biome == "Tropical & Subtropical Savannas"
                     ~ ((area_sq_km*0.78)+(area_sq_km*0.22*((Steidinger$median[
                       Steidinger$group_id == "Trop_savannah_AM"])/100))),
                     biome == "Tropical & Subtropical Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_EM"])/100)),
                     biome == "Montane Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Montane_shrub_AM"])/100)),
                     biome == "Xeric Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_AM"])/100)),
                     biome == "Temperate Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_AM"])/100)),
                     biome == "Mediterranean Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Med_forest_AM"])/100)),
                     biome == "Boreal Forests/Taiga"
                     ~ 0,
            .default = area_sq_km)) %>%
  mutate(EcM_area = #multiply by proportion of AM
           case_when(biome == "Tundra"
                     ~ (area_sq_km*0.37*((Steidinger$median[
                       Steidinger$group_id == "Tundra_EM"])/100)),
                     biome == "Temperate Broadleaf & Mixed Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Temp_mixed_EM"])/100)),
                     biome == "Temperate Conifer Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Temp_conifer_EM"])/100)),
                     biome == "Temperate Savannas"
                     ~ (area_sq_km*0.22*((Steidinger$median[
                       Steidinger$group_id == "Temp_savannah_EM"])/100)),
                     biome == "Tropical & Subtropical Moist Broadleaf Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Wet_trop_broadleaf_EM"])/100)),
                     biome == "Tropical & Subtropical Dry Broadleaf Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Dry_trop_broadleaf_EM"])/100)),
                     biome == "Tropical & Subtropical Coniferous Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Trop_conifer_EM"])/100)),
                     biome == "Tropical & Subtropical Savannas"
                     ~ (area_sq_km*0.22*((Steidinger$median[
                       Steidinger$group_id == "Trop_savannah_EM"])/100)),
                     biome == "Tropical & Subtropical Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_EM"])/100)),
                     biome == "Montane Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Montane_shrub_EM"])/100)),
                     biome == "Xeric Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_EM"])/100)),
                     biome == "Temperate Shrublands"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Xeric_shrub_EM"])/100)),
                     biome == "Mediterranean Forests"
                     ~ (area_sq_km*((Steidinger$median[
                       Steidinger$group_id == "Med_forest_EM"])/100)),
                     biome == "Temperate Grasslands"
                     ~ 0,
                     biome == "Tropical Grasslands"
                     ~ 0,
                     biome == "Flooded Grasslands"
                     ~ 0,
                     biome == "Montane Grasslands"
                     ~ 0,
                     biome == "Mangroves"
                     ~ 0,
                     biome == "Cropland"
                     ~ 0,
            .default = area_sq_km))

ecoregions_sum <- ecoregions_area %>%
  group_by(biome) %>% #group by biome
  select(biome, area_sq_km, AM_area, EcM_area) %>% #select only relevant columns
  summarise_at(c("area_sq_km", "AM_area", "EcM_area"), sum, na.rm = TRUE) #%>%

write.csv(ecoregions_sum, "ecoregions_sum.csv") #save as csv to save time on loading

ecoregions_sum <- read.csv("ecoregions_sum.csv") #read in data

AM_cover <- ecoregions_sum %>%
  filter(AM_area > 0) #remove 0 values

```

## Carbon Data

### Soil Data

#### International Soil Carbon Network Data

The [International Soil Carbon Network](http://iscn.fluxdata.org/) has made a global dataset of soil characteristics available for public use ([Nave et al. 2016](https://www.osti.gov/biblio/1305039)).

```{r soil data, error=FALSE}

#Github package for ISCN data - no longer supported
#install_github("ISCN/SOCDRaHR2")
#library(SOCDRaH2)
#ISCN <- ISCN3() #download ISCN data

#if/else loop for file download if the file isn't already downloaded
if(file.exists('/ISCN.csv')){ #if a file exists in working directory
		print('downloaded') #print result
	} else{ #if it doesn't exist
		download.file("https://pasta.lternet.edu/package/data/eml/edi/1160/1/4af719a84f8981fcc63f1f92760cb253", 
		              destfile= "ISCN.csv") #download file from link and name it
	} #end loop

ISCN <- read.csv("ISCN.csv", header=F 
          ,skip=1
            ,sep=";"  
                ,quot='"' 
        , col.names=c(
                    "ISCN.1.hyphen.1..paren.2015.hyphen.12.hyphen.10.paren.",     
                    "dataset_name_sub",     
                    "dataset_name_soc",     
                    "lat..paren.dec..deg.paren.",     
                    "long..paren.dec..deg.paren.",     
                    "datum..paren.datum.paren.",     
                    "state..paren.state_province.paren.",     
                    "country..paren.country.paren.",     
                    "site_name",     
                    "observation_date..paren.YYYY.hyphen.MM.hyphen.DD.paren.",     
                    "profile_name",     
                    "layer_name",     
                    "layer_top..paren.cm.paren.",     
                    "layer_bot..paren.cm.paren.",     
                    "hzn_desgn_other",     
                    "hzn",     
                    "hzn_desgn",     
                    "layer_note",     
                    "color",     
                    "vegclass_local",     
                    "soil_taxon",     
                    "soil_series",     
                    "bd_method",     
                    "bd_samp..paren.g.cm.hyphen.3.paren.",     
                    "bd_tot..paren.g.cm.hyphen.3.paren.",     
                    "bd_whole..paren.g.cm.hyphen.3.paren.",     
                    "bd_other..paren.g.cm.hyphen.3.paren.",     
                    "bdNRCS_prep_code",     
                    "cNRCS_prep_code",     
                    "c_method",     
                    "c_tot..paren.percent.paren.",     
                    "oc..paren.percent.paren.",     
                    "loi..paren.percent.paren.",     
                    "n_tot..paren.percent.paren.",     
                    "c_to_n..paren.mass.ratio.paren.",     
                    "soc..paren.g.cm.hyphen.2.paren.",     
                    "soc_carbon_flag",     
                    "soc_method",     
                    "ph_method",     
                    "ph_cacl",     
                    "ph_h2o",     
                    "ph_other",     
                    "caco3..paren.percent.paren.",     
                    "sand_tot_psa..paren.percent.paren.",     
                    "silt_tot_psa..paren.percent.paren.",     
                    "clay_tot_psa..paren.percent.paren.",     
                    "wpg2_method",     
                    "wpg2..paren.percent.paren.",     
                    "cat_exch..paren.cmol.H.plus..kg.hyphen.1.paren.",     
                    "al_dith..paren.specified.by.al_fe_units.paren.",     
                    "al_ox..paren.specified.by.al_fe_units.paren.",     
                    "al_other..paren.specified.by.al_fe_units.paren.",     
                    "fe_dith..paren.specified.by.al_fe_units.paren.",     
                    "fe_ox..paren.specified.by.al_fe_units.paren.",     
                    "fe_other..paren.specified.by.al_fe_units.paren.",     
                    "mn_dith..paren.specified.by.al_fe_units.paren.",     
                    "mn_ox..paren.specified.by.al_fe_units.paren.",     
                    "mn_other..paren.specified.by.al_fe_units.paren.",     
                    "al_fe_units..paren.extract_units.paren.",     
                    "al_fe_method",     
                    "ca_al..paren.specified.by.bc_units.paren.",     
                    "ca_ext..paren.specified.by.bc_units.paren.",     
                    "k_ext..paren.specified.by.bc_units.paren.",     
                    "mg_ext..paren.specified.by.bc_units.paren.",     
                    "na_ext..paren.specified.by.bc_units.paren.",     
                    "bc_units..paren.extract_units.paren.",     
                    "bc_method",     
                    "base_sum..paren.specified.by.cec_h_units.paren.",     
                    "cec_sum..paren.specified.by.cec_h_units.paren.",     
                    "ecec..paren.specified.by.cec_h_units.paren.",     
                    "cec_h_units..paren.extract_units.paren.",     
                    "bs..paren.percent.paren.",     
                    "bs_sum..paren.percent.paren.",     
                    "h_ext..paren.specified.by.metal_ext_units.paren.",     
                    "zn_ext..paren.specified.by.metal_ext_units.paren.",     
                    "metal_ext_units..paren.extract_units.paren.",     
                    "metal_ext_method",     
                    "p_bray..paren.specified.by.p_units.paren.",     
                    "p_ox..paren.specified.by.p_units.paren.",     
                    "p_meh..paren.specified.by.p_units.paren.",     
                    "p_other..paren.specified.by.p_units.paren.",     
                    "p_units..paren.extract_units.paren.",     
                    "p_method",     
                    "root_quant_size",     
                    "root_weight..paren.g.paren.",     
                    "v_15n..paren.√¢¬Ä¬∞.paren.",     
                    "v_13c..paren.√¢¬Ä¬∞.paren.",     
                    "v_14c..paren.√¢¬Ä¬∞.paren.",     
                    "v_14c_sigma..paren.√¢¬Ä¬∞.paren.",     
                    "v_14c_age..paren.BP.paren.",     
                    "v_14c_age_sigma..paren.BP.paren.",     
                    "fraction_modern",     
                    "fraction_modern_sigma",     
                    "textureClass",     
                    "locator_parent_alias"    ), check.names=TRUE)


#fix any interval or ratio columns mistakenly read in as nominal and nominal columns read as numeric or dates read as strings
if (class(ISCN$lat..paren.dec..deg.paren.)!="factor") ISCN$lat..paren.dec..deg.paren.<- as.factor(ISCN$lat..paren.dec..deg.paren.)
if (class(ISCN$long..paren.dec..deg.paren.)!="factor") ISCN$long..paren.dec..deg.paren.<- as.factor(ISCN$long..paren.dec..deg.paren.)
if (class(ISCN$datum..paren.datum.paren.)!="factor") ISCN$datum..paren.datum.paren.<- as.factor(ISCN$datum..paren.datum.paren.)
if (class(ISCN$layer_top..paren.cm.paren.)!="factor") ISCN$layer_top..paren.cm.paren.<- as.factor(ISCN$layer_top..paren.cm.paren.)
if (class(ISCN$layer_bot..paren.cm.paren.)!="factor") ISCN$layer_bot..paren.cm.paren.<- as.factor(ISCN$layer_bot..paren.cm.paren.)
if (class(ISCN$vegclass_local)!="factor") ISCN$vegclass_local<- as.factor(ISCN$vegclass_local)
if (class(ISCN$soil_taxon)!="factor") ISCN$soil_taxon<- as.factor(ISCN$soil_taxon)
if (class(ISCN$soil_series)!="factor") ISCN$soil_series<- as.factor(ISCN$soil_series)
if (class(ISCN$bd_method)!="factor") ISCN$bd_method<- as.factor(ISCN$bd_method)
if (class(ISCN$bd_samp..paren.g.cm.hyphen.3.paren.)!="factor") ISCN$bd_samp..paren.g.cm.hyphen.3.paren.<- as.factor(ISCN$bd_samp..paren.g.cm.hyphen.3.paren.)
if (class(ISCN$bd_tot..paren.g.cm.hyphen.3.paren.)!="factor") ISCN$bd_tot..paren.g.cm.hyphen.3.paren.<- as.factor(ISCN$bd_tot..paren.g.cm.hyphen.3.paren.)
if (class(ISCN$bd_whole..paren.g.cm.hyphen.3.paren.)!="factor") ISCN$bd_whole..paren.g.cm.hyphen.3.paren.<- as.factor(ISCN$bd_whole..paren.g.cm.hyphen.3.paren.)
if (class(ISCN$bd_other..paren.g.cm.hyphen.3.paren.)!="factor") ISCN$bd_other..paren.g.cm.hyphen.3.paren.<- as.factor(ISCN$bd_other..paren.g.cm.hyphen.3.paren.)
if (class(ISCN$c_method)!="factor") ISCN$c_method<- as.factor(ISCN$c_method)
if (class(ISCN$c_tot..paren.percent.paren.)!="factor") ISCN$c_tot..paren.percent.paren.<- as.factor(ISCN$c_tot..paren.percent.paren.)
if (class(ISCN$oc..paren.percent.paren.)!="factor") ISCN$oc..paren.percent.paren.<- as.factor(ISCN$oc..paren.percent.paren.)
if (class(ISCN$loi..paren.percent.paren.)!="factor") ISCN$loi..paren.percent.paren.<- as.factor(ISCN$loi..paren.percent.paren.)
if (class(ISCN$n_tot..paren.percent.paren.)!="factor") ISCN$n_tot..paren.percent.paren.<- as.factor(ISCN$n_tot..paren.percent.paren.)
if (class(ISCN$c_to_n..paren.mass.ratio.paren.)!="factor") ISCN$c_to_n..paren.mass.ratio.paren.<- as.factor(ISCN$c_to_n..paren.mass.ratio.paren.)
if (class(ISCN$soc..paren.g.cm.hyphen.2.paren.)!="factor") ISCN$soc..paren.g.cm.hyphen.2.paren.<- as.factor(ISCN$soc..paren.g.cm.hyphen.2.paren.)
if (class(ISCN$soc_carbon_flag)!="factor") ISCN$soc_carbon_flag<- as.factor(ISCN$soc_carbon_flag)
if (class(ISCN$soc_method)!="factor") ISCN$soc_method<- as.factor(ISCN$soc_method)
if (class(ISCN$ph_method)!="factor") ISCN$ph_method<- as.factor(ISCN$ph_method)
if (class(ISCN$ph_cacl)!="factor") ISCN$ph_cacl<- as.factor(ISCN$ph_cacl)
if (class(ISCN$ph_h2o)!="factor") ISCN$ph_h2o<- as.factor(ISCN$ph_h2o)
if (class(ISCN$ph_other)!="factor") ISCN$ph_other<- as.factor(ISCN$ph_other)
if (class(ISCN$sand_tot_psa..paren.percent.paren.)!="factor") ISCN$sand_tot_psa..paren.percent.paren.<- as.factor(ISCN$sand_tot_psa..paren.percent.paren.)
if (class(ISCN$silt_tot_psa..paren.percent.paren.)!="factor") ISCN$silt_tot_psa..paren.percent.paren.<- as.factor(ISCN$silt_tot_psa..paren.percent.paren.)
if (class(ISCN$clay_tot_psa..paren.percent.paren.)!="factor") ISCN$clay_tot_psa..paren.percent.paren.<- as.factor(ISCN$clay_tot_psa..paren.percent.paren.)
if (class(ISCN$root_quant_size)!="factor") ISCN$root_quant_size<- as.factor(ISCN$root_quant_size)
if (class(ISCN$root_weight..paren.g.paren.)!="factor") ISCN$root_weight..paren.g.paren.<- as.factor(ISCN$root_weight..paren.g.paren.)
if (class(ISCN$textureClass)!="factor") ISCN$textureClass<- as.factor(ISCN$textureClass)

#look at data structure
str(ISCN) #structure


#select only usable data
soil_df <- ISCN[, c(3:6, 20, 24, 26, 32, 36, 37, 41, 44:46)] %>% #dataset name, lat/long, vegclass, BDs, SOC, pH, sand/silt/clay
  filter(bd_whole..paren.g.cm.hyphen.3.paren. != "NA") %>% #filter out NA values
  mutate(BD = case_when(bd_samp..paren.g.cm.hyphen.3.paren. != "NA" ~ bd_samp..paren.g.cm.hyphen.3.paren., #use bd_samp if it's not 0
            TRUE ~ bd_whole..paren.g.cm.hyphen.3.paren.)) %>% #otherwise use bd_whole
  mutate(across(c(8,9,11:13), as.numeric)) #convert columns to numeric
```

```{r ISCN meta data, eval=FALSE}
#data file 2
#if/else loop for file download if the file isn't already downloaded
if(file.exists('/ISCN_2.csv')){ #if a file exists in working directory
		print('downloaded') #print result
	} else{ #if it doesn't exist
		download.file("https://pasta.lternet.edu/package/data/eml/edi/1160/1/40527580cc045d33d9a5aaf728bf204e", 
		              destfile= "ISCN_2.csv") #download file from link and name it
	} #end loop

ISCN_2 <- read.csv("ISCN_2.csv", header=F 
          ,skip=1
            ,sep=";"  
                ,quot='"' 
        , col.names=c(
                    "ISCN.1.hyphen.1..paren.2015.hyphen.12.hyphen.10.paren.",     
                    "dataset_name_sub",     
                    "dataset_name_soc",     
                    "lat..paren.dec..deg.paren.",     
                    "long..paren.dec..deg.paren.",     
                    "datum..paren.datum.paren.",     
                    "state..paren.state_province.paren.",     
                    "country..paren.country.paren.",     
                    "observation_date..paren.YYYY.hyphen.MM.hyphen.DD.paren.",     
                    "site_name",     
                    "profile_name",     
                    "profile_zero_ref..paren.profile_zero_ref.paren.",     
                    "layer_top..paren.cm.paren.",     
                    "layer_bot..paren.cm.paren.",     
                    "total_lcount",     
                    "carbon_lcount",     
                    "soc_lcount",     
                    "soc_depth..paren.cm.paren.",     
                    "soc..paren.g.cm.hyphen.2.paren.",     
                    "soc_method",     
                    "soc_spatial_flag",     
                    "soc_carbon_flag",     
                    "soil_taxon",     
                    "soil_series",     
                    "elevation..paren.m.paren.",     
                    "ecoregion",     
                    "landuse..paren.landsat.paren.",     
                    "vegclass_local",     
                    "surface_veg",     
                    "landscape..paren.landscape.paren.",     
                    "landform..paren.landform.paren.",     
                    "v_2d_position..paren.2d_position.paren.",     
                    "landform_note",     
                    "aspect_deg..paren.degree.paren.",     
                    "slope..paren.percent.paren.",     
                    "drainagecl..paren.drainage.paren.",     
                    "map..paren.mm.paren.",     
                    "mat..paren.√Ç¬∞C.paren.",     
                    "runoff..paren.runoff.paren.",     
                    "site_perm..paren.site_perm.paren.",     
                    "site_note",     
                    "thaw_depth_profile..paren.cm.paren.",     
                    "locator_alias",     
                    "locator_parent_alias"    ), check.names=TRUE)

#fix any interval or ratio columns mistakenly read in as nominal and nominal columns read as numeric or dates read as strings
if (class(ISCN_2$lat..paren.dec..deg.paren.)!="factor") ISCN_2$lat..paren.dec..deg.paren.<- as.factor(ISCN_2$lat..paren.dec..deg.paren.)
if (class(ISCN_2$long..paren.dec..deg.paren.)!="factor") ISCN_2$long..paren.dec..deg.paren.<- as.factor(ISCN_2$long..paren.dec..deg.paren.)
if (class(ISCN_2$datum..paren.datum.paren.)!="factor") ISCN_2$datum..paren.datum.paren.<- as.factor(ISCN_2$datum..paren.datum.paren.)
if (class(ISCN_2$layer_top..paren.cm.paren.)!="factor") ISCN_2$layer_top..paren.cm.paren.<- as.factor(ISCN_2$layer_top..paren.cm.paren.)
if (class(ISCN_2$layer_bot..paren.cm.paren.)!="factor") ISCN_2$layer_bot..paren.cm.paren.<- as.factor(ISCN_2$layer_bot..paren.cm.paren.)
if (class(ISCN_2$total_lcount)!="factor") ISCN_2$total_lcount<- as.factor(ISCN_2$total_lcount)
if (class(ISCN_2$carbon_lcount)!="factor") ISCN_2$carbon_lcount<- as.factor(ISCN_2$carbon_lcount)
if (class(ISCN_2$soc_lcount)!="factor") ISCN_2$soc_lcount<- as.factor(ISCN_2$soc_lcount)
if (class(ISCN_2$soc_depth..paren.cm.paren.)!="factor") ISCN_2$soc_depth..paren.cm.paren.<- as.factor(ISCN_2$soc_depth..paren.cm.paren.)
if (class(ISCN_2$soc..paren.g.cm.hyphen.2.paren.)!="factor") ISCN_2$soc..paren.g.cm.hyphen.2.paren.<- as.factor(ISCN_2$soc..paren.g.cm.hyphen.2.paren.)
if (class(ISCN_2$soc_method)!="factor") ISCN_2$soc_method<- as.factor(ISCN_2$soc_method)
if (class(ISCN_2$soc_spatial_flag)!="factor") ISCN_2$soc_spatial_flag<- as.factor(ISCN_2$soc_spatial_flag)
if (class(ISCN_2$soc_carbon_flag)!="factor") ISCN_2$soc_carbon_flag<- as.factor(ISCN_2$soc_carbon_flag)
if (class(ISCN_2$soil_taxon)!="factor") ISCN_2$soil_taxon<- as.factor(ISCN_2$soil_taxon)
if (class(ISCN_2$soil_series)!="factor") ISCN_2$soil_series<- as.factor(ISCN_2$soil_series)
if (class(ISCN_2$elevation..paren.m.paren.)!="factor") ISCN_2$elevation..paren.m.paren.<- as.factor(ISCN_2$elevation..paren.m.paren.)
if (class(ISCN_2$ecoregion)!="factor") ISCN_2$ecoregion<- as.factor(ISCN_2$ecoregion)
if (class(ISCN_2$landuse..paren.landsat.paren.)!="factor") ISCN_2$landuse..paren.landsat.paren.<- as.factor(ISCN_2$landuse..paren.landsat.paren.)
if (class(ISCN_2$vegclass_local)!="factor") ISCN_2$vegclass_local<- as.factor(ISCN_2$vegclass_local)
if (class(ISCN_2$surface_veg)!="factor") ISCN_2$surface_veg<- as.factor(ISCN_2$surface_veg)
if (class(ISCN_2$landscape..paren.landscape.paren.)!="factor") ISCN_2$landscape..paren.landscape.paren.<- as.factor(ISCN_2$landscape..paren.landscape.paren.)
if (class(ISCN_2$landform..paren.landform.paren.)!="factor") ISCN_2$landform..paren.landform.paren.<- as.factor(ISCN_2$landform..paren.landform.paren.)
if (class(ISCN_2$map..paren.mm.paren.)!="factor") ISCN_2$map..paren.mm.paren.<- as.factor(ISCN_2$map..paren.mm.paren.)
#if (class(ISCN_2$mat..paren.√Ç¬∞C.paren.)!="factor") ISCN_2$mat..paren.√Ç¬∞C.paren.<- as.factor(ISCN_2$mat..paren.√Ç¬∞C.paren.)
if (class(ISCN_2$locator_alias)!="factor") ISCN_2$locator_alias<- as.factor(ISCN_2$locator_alias)
if (class(ISCN_2$locator_parent_alias)!="factor") ISCN_2$locator_parent_alias<- as.factor(ISCN_2$locator_parent_alias)

#data file 3
#if/else loop for file download if the file isn't already downloaded
if(file.exists('/ISCN_3.csv')){ #if a file exists in working directory
		print('downloaded') #print result
	} else{ #if it doesn't exist
		download.file("https://pasta.lternet.edu/package/data/eml/edi/1160/1/320e31ca911f187550ca2143c31fd408", 
		              destfile= "ISCN_3.csv") #download file from link and name it
	} #end loop

ISCN_3 <-read.csv("ISCN_3.csv", header=F 
          ,skip=1
            ,sep=";"  
                ,quot='"' 
        , col.names=c(
                    "ISCN.1.hyphen.1..paren.2015.hyphen.12.hyphen.10.paren.",     
                    "dataset_name",     
                    "dataset_type..paren.dataset_type.paren.",     
                    "curator_name",     
                    "curator_organization",     
                    "curator_email",     
                    "reference",     
                    "citation",     
                    "citation_usage",     
                    "acknowledgement",     
                    "acknowledgement_usage",     
                    "modification_date..paren.YYYY.hyphen.MM.hyphen.DD.paren."    ), check.names=TRUE)
		    

#data file 4
#if/else loop for file download if the file isn't already downloaded
if(file.exists('/ISCN_4.csv')){ #if a file exists in working directory
		print('downloaded') #print result
	} else{ #if it doesn't exist
		download.file("https://pasta.lternet.edu/package/data/eml/edi/1160/1/cdd0c7a4cac3f28d6d788c91f506775f", 
		              destfile= "ISCN_4.csv") #download file from link and name it
	} #end loop

ISCN_4 <-read.csv("ISCN_4.csv", header=F 
          ,skip=1
            ,sep=";"  
                ,quot='"' 
        , col.names=c(
                    "ISCN.1.hyphen.1..paren.2015.hyphen.12.hyphen.10.paren.",     
                    "dataset_name",     
                    "dataset_type..paren.dataset_type.paren.",     
                    "curator_name",     
                    "curator_organization",     
                    "curator_email",     
                    "contact_name",     
                    "contact_email",     
                    "dataset_description",     
                    "total_scount",     
                    "total_pcount",     
                    "total_lcount",     
                    "soc_scount",     
                    "soc_pcount",     
                    "soc_lcount",     
                    "soc_scount_ISCN",     
                    "soc_pcount_ISCN",     
                    "soc_lcount_ISCN",     
                    "modification_date..paren.YYYY.hyphen.MM.hyphen.DD.paren."    ), check.names=TRUE)


```

#### Soil Organic Matter Fractions

To estimate how much C is stored in particulate organic matter (POM) or mineral-associated organic matter (MAOM) fractions across biomes globally, I used data from [Georgiou et al. 2022](https://www.nature.com/articles/s41467-022-31540-9). The top 30cm was selected to compare topsoil, and was scaled up to the area of global cover.

Regions were defined based on latitude, from the [Encyclopedia of World Climatology, 2005](https://link.springer.com/referencework/10.1007/1-4020-3266-8). I used a reference table from [Chapter]() linking soil orders to ecosystem types to further classify biomes in the SOM dataset. A mean annual precipitation of 2000mm or more was considered "moist" for tropical and subtropical broadleaf forests, while less than 2000mm was considered "dry" ([Siyum 2020](https://doi.org/10.1186/s13717-020-00229-6)).

The data was filtered to remove fallow land, and only the top 30cm of soil was used for analysis. The data was then merged with the global cover data to estimate C pools in Pg of C.

```{r SOM C data}

#MAOM and POM C data from Georgiou et al. 2022
SOMC <- read_csv("MOC_synthesis.csv") %>%
  rename("MAOM_C" = "SiltClayC") %>%
  filter(Vegetation != "Fallow") %>% #remove fallow
  na.omit() %>%
  mutate(region = #add region based on latitude
           case_when(Lat < 23.5 & Lat > -23.5 ~ "Tropical",
                     Lat < 30 & Lat > 23.5 | Lat < -23.5 & Lat > -30 ~ "Subtropical",
                     Lat < 66.5 & Lat > 30 | Lat < -30 & Lat > -66.5 ~ "Temperate",
                     Lat > 66.5 & Lat < -66.5 ~ "Arctic")) %>% #define regions
  mutate(biome = #define biomes more closely
           case_when(Vegetation == "Grassland" & region == "Temperate" 
                     ~ "Temperate Grasslands",
										 Vegetation == "Grassland" & region == "Tropical" 
                     ~ "Tropical & Subtropical Grasslands",
										 Vegetation == "Grassland" & region == "Subtropical" 
                     ~ "Tropical & Subtropical Grasslands",
										 Vegetation == "Pasture" & region == "Temperate" 
                     ~ "Temperate Grasslands",
										 Vegetation == "Pasture" & region == "Tropical" 
                     ~ "Tropical & Subtropical Grasslands",
										 Vegetation == "Pasture" & region == "Subtropical" 
                     ~ "Tropical & Subtropical Grasslands",
										 Vegetation == "Savanna" & region == "Temperate" 
                     ~ "Temperate Savannas",
										 Vegetation == "Savanna" & region == "Tropical" 
                     ~ "Tropical & Subtropical Savannas",
										 Vegetation == "Savanna" & region == "Subtropical" 
                     ~ "Tropical & Subtropical Savannas",
										 Vegetation == "Shrubland" & region == "Temperate" 
                     ~ "Temperate Shrublands",
										 Vegetation == "Shrubland" & region == "Tropical" 
                     ~ "Tropical & Subtropical Shrublands",
										 Vegetation == "Shrubland" & region == "Subtropical" 
                     ~ "Tropical & Subtropical Shrublands",
										 Vegetation == "Temperate Forest" & Soil.order == "Alfisols" 
                     ~ "Temperate Broadleaf & Mixed Forests",
										 Vegetation == "Temperate Forest" & Soil.order == "Entisols" 
                     ~ "Temperate Conifer Forests",
										 Vegetation == "Temperate Forest" & Soil.order == "Inceptisols" 
                     ~ "Temperate Conifer Forests",
										 Vegetation == "Tropical Forest" & Soil.order == "Inceptisols" 
                     ~ "Tropical & Subtropical Coniferous Forests",
										 Vegetation == "Temperate Forest" & Soil.order == "Mollisols" 
                     ~ "Temperate Broadleaf & Mixed Forests",
										 Vegetation == "Tropical Forest" & Soil.order == "Oxisols" & MAP > 2000 
                     ~ "Tropical & Subtropical Moist Broadleaf Forests",
										 Vegetation == "Tropical Forest" & Soil.order == "Oxisols" & MAP < 2000 
                     ~ "Tropical & Subtropical Dry Broadleaf Forests",
										 Vegetation == "Temperate Forest" & Soil.order == "Spodosols" 
                     ~ "Temperate Broadleaf & Mixed Forests",
										 Vegetation == "Tropical Forest" & Soil.order == "Ultisols" & MAP > 2000
                     ~ "Tropical & Subtropical Moist Broadleaf Forests",
										 Vegetation == "Tropical Forest" & Soil.order == "Ultisols" & MAP < 2000
                     ~ "Tropical & Subtropical Dry Broadleaf Forests",
													 .default = Vegetation)) #set default value
  

SOMC_top30_means <- SOMC %>%
  filter(Bottom.depth <= 30) %>%
  select(biome, Top.depth, Bottom.depth, Bulk.C, MAOM_C, POM_C) %>%
  group_by(biome) %>%
  summarise_if(is.numeric, mean, na.rm = TRUE)

#Scale to area of biome, using average bulk density & sampling depth
biomes_C <- merge(ecoregions_sum, SOMC_top30_means, all.x = TRUE) %>%
  mutate(SOM_PgC = (1.33*(Bottom.depth)*10000000000)*
           (Bulk.C/1000000000000000000)*area_sq_km) %>%
  mutate(MAOM_PgC = (1.33*(Bottom.depth)*10000000000)*
           (MAOM_C/1000000000000000000)*area_sq_km) %>%
  mutate(POM_PgC = (1.33*(Bottom.depth)*10000000000)*
           (POM_C/1000000000000000000)*area_sq_km)

write_csv(biomes_C, "Cpools30cm.csv")

library(gt)

C_table <- biomes_C

C_table <- C_table %>%
  column_to_rownames(var = "biome") %>%
  signif(., 4) #round to 4 significant figures

gt(C_table, 
   rownames_to_stub=TRUE)

```



### Plant Carbon

Aboveground carbon (C) and root C were taken from previous C estimates and root:shoot ratios ([Robinson 2007](https://royalsocietypublishing.org/doi/10.1098/rspb.2007.1012), [Liu et al. 2015](https://www.nature.com/articles/nclimate2581)). All C data is in petagrams (Pg) of C.

```{r plant C data}

#aboveground and root C data from Robinson 2007, Liu et al. 2015
#used proportion of root:shoot from Robinson 2007 to fill in Liu et al. 2015 root C estimates - in Pg C
plantC <- read_csv("plantC.csv")

```

### AM Fungal Carbon

To estimate the contribution of AM fungal biomass to global C pools, I used the estimated amount of AM extra-radical hyphal biomass C in grams per square meter (g/m^2) from [Soudzilovskaia et al. 2015](https://onlinelibrary.wiley.com/doi/10.1111/nph.13447), scaled it to total biome area, and converted the units to Pg of C. Additionally, I included estimated C allocation from plants to mycorrhizae per year based on vegetation type averages from [Hawkins et al. 2023](https://doi.org/10.1016/j.cub.2023.02.027) and scaled to total biome area for a Pg of C per year estimate.


```{r AM C data}

#merge with cover, add ERH C based on Soudzilovskaia et al. 2015 - g/m-2 estimates. Different than C flux from Hawkins et al. 2023
coverC <- merge(AM_cover, plantC, 
	by="Ecosystem", all.x = T) %>% #merge 
  mutate(AMbio_C = (Area*1000000)*0.0000000000000475) #add ERH

AM_cover <- AM_cover %>%
  mutate(AMbio_C = (AM_area*1000000)*0.0000000000000475) #add ERH

#C flux per veg type via Hawkins et al. 2023

#Croplands
cropAM <- coverC %>%
  filter(Ecosystem == "Cropland") %>%
  mutate(Allo_C = AGB_C * 0.033) 
coverC2 <- merge(coverC, cropAM)

#Savannas & shrublands
ssAM <- coverC %>%
  filter(Ecosystem == "Savanna & Shrubland") %>%
  mutate(Allo_C = (AGB_C/2 * 0.065) + (AGB_C/2 * 0.023))
coverC2 <- rbind(coverC2, ssAM)

#Temperate grasslands
tgAM <- coverC %>%
  filter(Ecosystem == "Temperate Grassland") %>%
  mutate(Allo_C = AGB_C * 0.065) 
coverC2 <- rbind(coverC2, tgAM)

#Temperate forests
tfAM <- coverC %>%
  filter(Ecosystem == "Temperate Forest") %>%
  mutate(Allo_C = AGB_C * 0.023) 
coverC2 <- rbind(coverC2, tfAM)

#Tropical forests
trfAM <- coverC %>%
  filter(Ecosystem == "Tropical Forest") %>%
  mutate(Allo_C = AGB_C * 0.023) 
coverC2 <- rbind(coverC2, trfAM)

```

## Plots

### Region area graph
```{r area graph, echo=FALSE, fig.cap="Area of each biome in square kilometers", fig.width=8, fig.height=5}

#Melt the data frame to long format for ggplot
AM_EcM_prop <- ecoregions_sum %>%
  pivot_longer(cols = c(AM_area, EcM_area), names_to = "mycorrhizal_type", values_to = "area") 

ggplot(AM_EcM_prop, aes(x=reorder(biome, -area), y=area, fill=mycorrhizal_type)) +
  geom_bar(stat="summary", width = 0.7, position="stack", colour="black") +
  scale_x_discrete(guide = guide_axis(angle = 45)) +
  labs(title="Area of each biome and mycorrhizal dominance",
       x="Biome",
       y="Area (sq km)",
       fill="Mycorrhizal type") +
  scale_fill_d3("category20c", labels=c("AM", "EcM")) + #color palette from science package
  theme_minimal() +
  scale_y_continuous(labels = scales::comma) #add commas to y axis labels

ggsave("AM_EcM_area.png", path = "Figures", #save to folder within working directory
       width = 8, height = 5, dpi = 300, bg=NULL) #save figure

```

### AM biomass C graph

```{r plot AM bio}

#bar chart AM biomass C
ggplot(AM_cover, aes(x=biome, y=AMbio_C, fill=biome)) + 
    geom_bar(position="dodge", stat = "identity", width = 0.7, colour="black") + #add proportion bars with black outline
    scale_x_discrete(guide = guide_axis(angle = 45)) +
    scale_fill_d3("category20c") +
    theme_minimal() 

```


```{r plot AM allocation}

#bar chart AM allocation C
ggplot(coverC_top30, aes(x=Ecosystem, y=Allo_C, fill=Ecosystem)) + 
    geom_boxplot(aes(group=Ecosystem, value=Allo_C)) + #add proportion bars with black outline
    scale_x_discrete(guide = guide_axis(angle = 45)) +
    scale_fill_manual(values = wes_palette("Zissou1")) + #call from wesanderson library
    theme_few() #remove grid, white background, box around plot - from ggthemes

```


## References


Nave, L., K. Johnson, C. van Ingen, D. Agarwal, M. Humphrey, and N. Beekwilder. 2022. International Soil Carbon Network version 3 Database (ISCN3) ver 1. Environmental Data Initiative. https://doi.org/10.6073/pasta/cc751923c5576b95a6d6a227d5afe8ba

